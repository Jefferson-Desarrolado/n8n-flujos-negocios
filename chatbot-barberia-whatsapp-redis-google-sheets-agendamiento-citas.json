{
  "name": "Chatbot Barber√≠a - Google Sheets + Redis+what+citas",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "evolution-in",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "d873744c-9e51-4baa-8fe1-2f4d2e419b20",
      "name": "Webhook",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1.1,
      "position": [
        -656,
        112
      ],
      "webhookId": "evolution-api"
    },
    {
      "parameters": {
        "jsCode": "// Extraer informaci√≥n del webhook\nconst phone = $input.item.json.body.data.key.remoteJid.split('@')[0];\nconst message = ($input.item.json.body.data.message.conversation || '').toLowerCase().trim();\nconst pushName = $input.item.json.body.data.pushName || 'Usuario';\nconst instanceId = $input.item.json.body.instance;\n\nreturn {\n  json: {\n    phone: phone,\n    message: message,\n    pushName: pushName,\n    instanceId: instanceId,\n    timestamp: new Date().toISOString(),\n    redisKey: `barberia:conversation:${phone}`\n  }\n};"
      },
      "id": "6cce49c6-9541-4f32-b9c2-565870e3068f",
      "name": "Extraer Datos",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -448,
        112
      ]
    },
    {
      "parameters": {
        "operation": "get",
        "key": "={{ $json.redisKey }}",
        "options": {}
      },
      "id": "7bc041ba-fe19-49a7-bc2b-908039f43bd4",
      "name": "Redis Get",
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        -224,
        112
      ],
      "credentials": {
        "redis": {
          "id": "2bSQXmfRqLV6Z8jI",
          "name": "Redis account"
        }
      },
      "continueOnFail": true
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1pfaOsE9rjd9PHStqX1ogg8pn2kG3anLbThy6fs7vSBA/edit?gid=0#gid=0",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "servicios_disponibles",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1pfaOsE9rjd9PHStqX1ogg8pn2kG3anLbThy6fs7vSBA/edit#gid=0"
        },
        "options": {
          "dataLocationOnSheet": {
            "values": {
              "rangeDefinition": "specifyRangeA1",
              "range": "A1:E100"
            }
          },
          "returnAllMatches": "returnAllMatches"
        }
      },
      "id": "846f662e-d3ef-4581-a348-3f800b4af100",
      "name": "Google Sheets - Servicios",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4,
      "position": [
        0,
        0
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "YK24ixs7cH2x2oyZ",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// ========================================\n// MOTOR DE L√ìGICA - VERSI√ìN FINAL CORREGIDA\n// ========================================\n\n// Obtener datos del contexto\nconst phone = $('Extraer Datos').item.json.phone;\nconst message = $('Extraer Datos').item.json.message;\nconst pushName = $('Extraer Datos').item.json.pushName;\nconst redisKey = $('Extraer Datos').item.json.redisKey;\n\n// ===== OBTENER ESTADO DE REDIS (CORREGIDO) =====\nlet previousState = { step: 'inicio', userName: pushName };  // ‚Üê DEFAULT\n\ntry {\n  const redisData = $('Redis Get').item.json;\n  \n  // ‚úÖ VERIFICAR M√öLTIPLES FORMATOS POSIBLES\n  let redisValue = null;\n  \n  if (redisData) {\n    // Formato 1: { value: \"...\" }\n    if (redisData.value) {\n      redisValue = redisData.value;\n    }\n    // Formato 2: { propertyName: \"...\" }\n    else if (redisData.propertyName) {\n      redisValue = redisData.propertyName;\n    }\n    // Formato 3: El objeto completo ES el estado\n    else if (redisData.step) {\n      previousState = redisData;\n      redisValue = null; // Ya tenemos el estado\n    }\n  }\n  \n  // Parsear si es JSON string\n  if (redisValue && typeof redisValue === 'string') {\n    try {\n      previousState = JSON.parse(redisValue);\n    } catch (parseError) {\n      console.error('‚ùå Error parseando Redis:', parseError);\n    }\n  }\n  \n  console.log('‚úÖ Estado recuperado:', JSON.stringify(previousState));\n  \n} catch (e) {\n  console.error('‚ùå Error leyendo Redis:', e.message);\n  previousState = { step: 'inicio', userName: pushName };\n}\n\n// ===== OBTENER SERVICIOS =====\nconst servicios = $('Google Sheets - Servicios').all();\n\nif (!servicios || servicios.length === 0) {\n  return {\n    json: {\n      phone: phone,\n      pushName: pushName,\n      response: '‚ö†Ô∏è Error al cargar servicios. Intenta m√°s tarde.',\n      redisKey: redisKey,\n      redisValue: JSON.stringify({ step: 'menu_principal', userName: pushName }),\n      shouldSaveToSheets: false,\n      appointmentData: {}\n    }\n  };\n}\n\nconsole.log('üìä Servicios cargados:', servicios.length);\n\n// ===== INICIALIZAR VARIABLES =====\nlet response = '';\nlet newState = {};\nlet shouldSaveToSheets = false;\nlet appointmentData = {};\n\nconst currentStep = previousState.step || 'inicio';\n\nconsole.log('‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ');\nconsole.log('üìç ESTADO ACTUAL:', currentStep);\nconsole.log('üí¨ MENSAJE:', message);\nconsole.log('üë§ USUARIO:', pushName);\nconsole.log('‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ');\n\n// ========================================\n// M√ÅQUINA DE ESTADOS\n// ========================================\n\n// ===== CASO 1: SALUDO (SIEMPRE TIENE PRIORIDAD) =====\nif (message === 'hola' || message === 'hi' || message === 'menu' || message === 'inicio') {\n  console.log('‚úÖ BLOQUE: Saludo/Inicio');\n  \n  response = `¬°Hola *${pushName}*! üëã Bienvenido a nuestra barber√≠a.\\n\\n¬øEn qu√© puedo ayudarte?\\n\\n1Ô∏è‚É£ Ver servicios disponibles\\n2Ô∏è‚É£ Agendar una cita\\n\\nEscribe el n√∫mero de tu opci√≥n.`;\n  \n  newState = {\n    step: 'menu_principal',\n    userName: pushName\n  };\n}\n\n// ===== CASO 2: ELIGIENDO SERVICIO =====\nelse if (currentStep === 'eligiendo_servicio') {\n  console.log('‚úÖ BLOQUE: Eligiendo servicio');\n  \n  // Convertir mensaje a n√∫mero\n  const servicioNumero = parseInt(message.trim());\n  \n  console.log('üîç N√∫mero ingresado:', servicioNumero);\n  console.log('üîç Es n√∫mero v√°lido:', !isNaN(servicioNumero));\n  console.log('üîç Rango v√°lido: 1-' + servicios.length);\n  \n  if (isNaN(servicioNumero) || servicioNumero < 1 || servicioNumero > servicios.length) {\n    console.log('‚ùå N√∫mero fuera de rango');\n    \n    response = `‚ö†Ô∏è Opci√≥n inv√°lida: \"${message}\"\\n\\nPor favor elige un n√∫mero del 1 al ${servicios.length}.`;\n    \n    newState = {\n      step: 'eligiendo_servicio',\n      userName: pushName\n    };\n  } \n  else {\n    // Usar √≠ndice de array (empieza en 0)\n    const servicioSeleccionado = servicios[servicioNumero - 1];\n    \n    console.log('‚úÖ Servicio seleccionado:', servicioSeleccionado.json.nombre_servicio);\n    \n    const nombre = String(servicioSeleccionado.json.nombre_servicio).trim();\n    const precio = servicioSeleccionado.json.precio;\n    const duracion = servicioSeleccionado.json.duracion_minutos;\n    \n    response = `Perfecto! ‚úÖ\\n\\n*Servicio:* ${nombre}\\n*Precio:* $${precio}\\n*Duraci√≥n:* ${duracion} min\\n\\nüìÖ ¬øQu√© d√≠a deseas tu cita?\\n\\nEjemplos:\\n- Ma√±ana\\n- Lunes\\n- 15/02/2026`;\n    \n    newState = {\n      step: 'eligiendo_fecha',\n      userName: pushName,\n      servicio_id: String(servicioNumero),\n      servicio_nombre: nombre,\n      servicio_precio: precio,\n      servicio_duracion: duracion\n    };\n  }\n}\n\n// ===== CASO 3: VIENDO SERVICIOS =====\nelse if (currentStep === 'viendo_servicios') {\n  console.log('‚úÖ BLOQUE: Viendo servicios');\n  \n  if (message === '2' || message.includes('agendar')) {\n    let serviciosTexto = 'üìÖ *AGENDAR CITA*\\n\\nSelecciona el servicio:\\n\\n';\n    \n    servicios.forEach((servicio, idx) => {\n      const numero = idx + 1;\n      const nombre = servicio.json.nombre_servicio;\n      const precio = servicio.json.precio;\n      serviciosTexto += `${numero}. ${nombre} - $${precio}\\n`;\n    });\n    \n    serviciosTexto += '\\nEscribe el *n√∫mero* del servicio.';\n    \n    response = serviciosTexto;\n    newState = {\n      step: 'eligiendo_servicio',\n      userName: pushName\n    };\n  } \n  else if (message === '0' || message === 'menu') {\n    response = `¬øEn qu√© puedo ayudarte?\\n\\n1Ô∏è‚É£ Ver servicios\\n2Ô∏è‚É£ Agendar cita`;\n    newState = {\n      step: 'menu_principal',\n      userName: pushName\n    };\n  } \n  else {\n    response = `Escribe:\\n\\n2Ô∏è‚É£ Para agendar\\n0Ô∏è‚É£ Volver al men√∫`;\n    newState = previousState;  // Mantener estado\n  }\n}\n\n// ===== CASO 4: ELIGIENDO FECHA =====\nelse if (currentStep === 'eligiendo_fecha') {\n  console.log('‚úÖ BLOQUE: Eligiendo fecha');\n  \n  const fecha = message;\n  \n  response = `üìÖ Fecha: *${fecha}*\\n\\nüïê ¬øA qu√© hora?\\n\\nEjemplos:\\n- 10am\\n- 14:30\\n- 3pm`;\n  \n  newState = {\n    ...previousState,\n    step: 'eligiendo_hora',\n    fecha: fecha\n  };\n}\n\n// ===== CASO 5: ELIGIENDO HORA =====\nelse if (currentStep === 'eligiendo_hora') {\n  console.log('‚úÖ BLOQUE: Eligiendo hora');\n  \n  const hora = message;\n  \n  response = `üìã *CONFIRMA TU CITA:*\\n\\nüë§ Nombre: ${previousState.userName}\\nüíá Servicio: ${previousState.servicio_nombre}\\nüí∞ Precio: $${previousState.servicio_precio}\\nüìÖ Fecha: ${previousState.fecha}\\nüïê Hora: ${hora}\\n‚è±Ô∏è Duraci√≥n: ${previousState.servicio_duracion} min\\n\\n¬øTodo correcto?\\n\\n‚úÖ Escribe *SI* para confirmar\\n‚ùå Escribe *NO* para cancelar`;\n  \n  newState = {\n    ...previousState,\n    step: 'confirmando',\n    hora: hora\n  };\n}\n\n// ===== CASO 6: CONFIRMANDO (CON ID AUTOM√ÅTICO) =====\nelse if (currentStep === 'confirmando') {\n  console.log('‚úÖ BLOQUE: Confirmando');\n  \n  if (message === 'si' || message === 's√≠' || message === 'confirmar' || message === 'ok' || message === 's') {\n    shouldSaveToSheets = true;\n    \n    // ‚úÖ GENERAR ID √öNICO\n    const citaId = Date.now().toString().slice(-8);\n    \n    appointmentData = {\n      id: citaId,                           // ‚úÖ ID √öNICO GENERADO\n      phone_number: phone,\n      nombre: previousState.userName,\n      fecha: previousState.fecha,\n      hora: previousState.hora,\n      servicio: previousState.servicio_nombre,\n      estado: 'Confirmada'\n    };\n    \n    console.log('üíæ Guardando cita:', JSON.stringify(appointmentData));\n    \n    response = `‚úÖ *CITA CONFIRMADA!*\\n\\nüìã ID: ${citaId}\\nüë§ ${previousState.userName}\\nüíá ${previousState.servicio_nombre}\\nüìÖ ${previousState.fecha} a las ${previousState.hora}\\n\\n¬°Te esperamos! üéâ\\n\\n¬øNecesitas algo m√°s?\\n1Ô∏è‚É£ Ver servicios\\n2Ô∏è‚É£ Otra cita`;\n    \n    newState = {\n      step: 'menu_principal',\n      userName: pushName\n    };\n  } \n  else if (message === 'no' || message === 'n' || message === 'cancelar') {\n    response = `‚ùå Cita cancelada.\\n\\n¬øDeseas intentar de nuevo?\\n\\n1Ô∏è‚É£ Ver servicios\\n2Ô∏è‚É£ Agendar cita`;\n    newState = {\n      step: 'menu_principal',\n      userName: pushName\n    };\n  } \n  else {\n    response = `Por favor responde:\\n\\n‚úÖ *SI* para confirmar\\n‚ùå *NO* para cancelar`;\n    newState = previousState;  // Mantener estado\n  }\n}\n\n// ===== CASO 7: MEN√ö PRINCIPAL / INICIO =====\nelse if (currentStep === 'menu_principal' || currentStep === 'inicio') {\n  console.log('‚úÖ BLOQUE: Men√∫ principal');\n  \n  if (message === '1' || message.includes('servicio')) {\n    let serviciosTexto = 'üìã *NUESTROS SERVICIOS:*\\n\\n';\n    \n    servicios.forEach((servicio, idx) => {\n      const numero = idx + 1;\n      const nombre = servicio.json.nombre_servicio;\n      const duracion = servicio.json.duracion_minutos;\n      const precio = servicio.json.precio;\n      const descripcion = servicio.json.descripcion || '';\n      \n      serviciosTexto += `${numero}. *${nombre}*\\n   üí∞ $${precio} | ‚è±Ô∏è ${duracion} min\\n   ${descripcion}\\n\\n`;\n    });\n    \n    serviciosTexto += '¬øDeseas agendar alguno? Escribe:\\n\\n2Ô∏è‚É£ Para agendar cita\\n0Ô∏è‚É£ Volver al men√∫';\n    \n    response = serviciosTexto;\n    newState = {\n      step: 'viendo_servicios',\n      userName: pushName\n    };\n  } \n  else if (message === '2' || message.includes('agendar') || message.includes('cita')) {\n    let serviciosTexto = 'üìÖ *AGENDAR CITA*\\n\\nSelecciona el servicio:\\n\\n';\n    \n    servicios.forEach((servicio, idx) => {\n      const numero = idx + 1;\n      const nombre = servicio.json.nombre_servicio;\n      const precio = servicio.json.precio;\n      serviciosTexto += `${numero}. ${nombre} - $${precio}\\n`;\n    });\n    \n    serviciosTexto += '\\nEscribe el *n√∫mero* del servicio que deseas.';\n    \n    response = serviciosTexto;\n    newState = {\n      step: 'eligiendo_servicio',\n      userName: pushName\n    };\n  } \n  else {\n    response = `No entend√≠ tu opci√≥n, *${pushName}*. üòÖ\\n\\nEscribe:\\n\\n1Ô∏è‚É£ Ver servicios\\n2Ô∏è‚É£ Agendar cita`;\n    newState = {\n      step: 'menu_principal',\n      userName: pushName\n    };\n  }\n}\n\n// ===== CASO 8: ESTADO DESCONOCIDO =====\nelse {\n  console.log('‚ùå BLOQUE: Estado desconocido');\n  \n  response = `¬°Hola *${pushName}*! üëã\\n\\n¬øEn qu√© puedo ayudarte?\\n\\n1Ô∏è‚É£ Ver servicios\\n2Ô∏è‚É£ Agendar cita`;\n  newState = {\n    step: 'menu_principal',\n    userName: pushName\n  };\n}\n\n// ========================================\n// RETORNAR RESULTADO\n// ========================================\n\nconsole.log('üì§ Nuevo estado:', JSON.stringify(newState));\nconsole.log('‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ');\n\nreturn {\n  json: {\n    phone: phone,\n    pushName: pushName,\n    response: response,\n    redisKey: redisKey,\n    redisValue: JSON.stringify(newState),\n    shouldSaveToSheets: shouldSaveToSheets,\n    appointmentData: appointmentData\n  }\n};"
      },
      "id": "f7ac65c5-9a5f-4616-9a5e-4dc16ff69e46",
      "name": "Motor de L√≥gica",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        224,
        112
      ]
    },
    {
      "parameters": {
        "operation": "set",
        "key": "={{ $json.redisKey }}",
        "value": "={{ $json.redisValue }}",
        "expire": true,
        "ttl": 3600
      },
      "id": "9651f427-c8aa-45c7-abcf-0851b6dc7bb4",
      "name": "Redis Set",
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        448,
        112
      ],
      "credentials": {
        "redis": {
          "id": "2bSQXmfRqLV6Z8jI",
          "name": "Redis account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "boolean": [
            {
              "value1": "={{ $json.shouldSaveToSheets }}",
              "value2": true
            }
          ]
        }
      },
      "id": "02e99c3e-5328-47c0-af95-687768bfa94b",
      "name": "¬øGuardar en Sheets?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        672,
        112
      ]
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1pMTLvFjHPcBQD0elT-Kbbuh29zMY61JhwK5Z9eDJtZc/edit?gid=0#gid=0",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "citas_agendadas",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1pMTLvFjHPcBQD0elT-Kbbuh29zMY61JhwK5Z9eDJtZc/edit#gid=0"
        },
        "columns": {
          "mappingMode": "autoMapInputData",
          "value": {
            "nombre ": "={{ $json.appointmentData.nombre }}",
            "estado": "={{ $json.appointmentData.estado }}"
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "phone_number",
              "displayName": "phone_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "nombre ",
              "displayName": "nombre ",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "fecha",
              "displayName": "fecha",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "hora",
              "displayName": "hora",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "servicio   ",
              "displayName": "servicio   ",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "estado",
              "displayName": "estado",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "id": "fa0a68ad-5ad2-4f7b-ba9b-187ef77cc0e3",
      "name": "Google Sheets - Guardar Cita",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4,
      "position": [
        976,
        0
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "YK24ixs7cH2x2oyZ",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "http://evolution_api:8080/message/sendText/Jefferson",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            },
            {
              "name": "apikey",
              "value": "MiClaveSecreta2026XYZ"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ JSON.stringify({ number: $('Motor de L√≥gica').item.json.phone, text: $('Motor de L√≥gica').item.json.response }) }}",
        "options": {}
      },
      "id": "21310a79-607e-4089-8a76-11d7e2891b11",
      "name": "Enviar Mensaje WhatsApp",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1104,
        112
      ]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ { \"success\": true } }}",
        "options": {}
      },
      "id": "84824c70-8369-4142-b2ea-7e4e49cd01e4",
      "name": "Respond to Webhook",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [
        1328,
        112
      ]
    },
    {
      "parameters": {
        "jsCode": "// Preparar datos en el orden exacto de las columnas de Google Sheets\nconst data = $input.item.json.appointmentData;\n\nconsole.log('üìä PREPARANDO DATOS PARA GOOGLE SHEETS');\nconsole.log('Datos recibidos:', JSON.stringify(data, null, 2));\n\n// Verificar que todos los campos existan\nif (!data || !data.id || !data.phone_number || !data.nombre) {\n  console.error('‚ùå ERROR: Faltan campos obligatorios');\n  console.error('appointmentData:', data);\n  throw new Error('Datos incompletos para guardar en Google Sheets');\n}\n\n// Retornar en el ORDEN EXACTO de las columnas: A, B, C, D, E, F, G\nconst resultado = {\n  id: data.id,\n  phone_number: data.phone_number,\n  nombre: data.nombre,\n  fecha: data.fecha,\n  hora: data.hora,\n  servicio: data.servicio,\n  estado: data.estado\n};\n\n\nconsole.log('‚úÖ Datos formateados:', JSON.stringify(resultado, null, 2));\n\nreturn [\n  {\n    json: resultado\n  }\n];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        800,
        0
      ],
      "id": "fce7115d-85a1-4721-ab2d-008ff4dac04c",
      "name": "Code in JavaScript"
    }
  ],
  "pinData": {},
  "connections": {
    "Webhook": {
      "main": [
        [
          {
            "node": "Extraer Datos",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extraer Datos": {
      "main": [
        [
          {
            "node": "Redis Get",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Redis Get": {
      "main": [
        [
          {
            "node": "Google Sheets - Servicios",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Sheets - Servicios": {
      "main": [
        [
          {
            "node": "Motor de L√≥gica",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Motor de L√≥gica": {
      "main": [
        [
          {
            "node": "Redis Set",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Redis Set": {
      "main": [
        [
          {
            "node": "¬øGuardar en Sheets?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "¬øGuardar en Sheets?": {
      "main": [
        [
          {
            "node": "Code in JavaScript",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Enviar Mensaje WhatsApp",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Sheets - Guardar Cita": {
      "main": [
        [
          {
            "node": "Enviar Mensaje WhatsApp",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Enviar Mensaje WhatsApp": {
      "main": [
        [
          {
            "node": "Respond to Webhook",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript": {
      "main": [
        [
          {
            "node": "Google Sheets - Guardar Cita",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1",
    "availableInMCP": false
  },
  "versionId": "b1e2dc2a-6d98-466a-ba06-3cbf538e7d42",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "04fa49b5342683f3459c11df7acab88fd9d5826423bbee4173c0a22e9e21410c"
  },
  "id": "33XU2N5Fi0QVtTM_Hn28w",
  "tags": []
}